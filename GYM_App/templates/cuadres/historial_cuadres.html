{% extends "base.html" %}

{% block styles %}
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
<style>
    .diferencia-cell.faltante {
        color: #dc3545;
        font-weight: bold;
    }
    .diferencia-cell.sobrante {
        color: #28a745;
        font-weight: bold;
    }
    .diferencia-cell.perfecto {
        color: #007bff;
        font-weight: bold;
    }
    .table-container {
        box-shadow: 0 4px 6px rgba(0,0,0,.1);
        border-radius: .5rem;
        overflow: hidden;
    }
</style>
{% endblock %}

{% block content %}
<div class="container mt-5">
    <div class="module-header d-flex justify-content-between align-items-center mb-4">
        <h2 class="module-title"><i class="fas fa-history me-2"></i> Historial de Cuadres de Caja</h2>
        <a href="{{ url_for('cuadres.cierre_caja') }}" class="btn btn-primary btn-icon-text">
            <i class="fas fa-cash-register me-1"></i> Ir a Cierre de Caja
        </a>
    </div>

    <div class="table-responsive table-container">
        <table class="table table-striped table-hover mb-0">
            <thead class="table-dark">
                <tr>
                    <th>ID Cuadre</th>
                    <th>Fecha y Hora de Cierre</th>
                    <th>Ventas Efectivo (Sistema)</th>
                    <th>Monto Contado (Físico)</th>
                    <th>Diferencia</th>
                    <th>Realizado por</th>
                    <th>Ventas Totales (Sistema)</th>
                </tr>
            </thead>
            <tbody>
                {% for cuadre in cuadres %}
                {% set diferencia = cuadre.diferencia|float %}
                <tr class="{% if diferencia < 0 %}table-danger{% elif diferencia > 0 %}table-warning{% endif %}">
                    <td>#{{ cuadre.id }}</td>
                    <td>{{ cuadre.fecha_cierre.strftime('%d/%m/%Y %H:%M:%S') }}</td>
                    <td>${{ "%.2f"|format(cuadre.ventas_efectivo_sistema) }}</td>
                    <td>${{ "%.2f"|format(cuadre.monto_contado_efectivo) }}</td>
                    <td class="diferencia-cell {% if diferencia < 0 %}faltante{% elif diferencia > 0 %}sobrante{% else %}perfecto{% endif %}">
                        {% if diferencia > 0 %}<i class="fas fa-plus me-1"></i>{% elif diferencia < 0 %}<i class="fas fa-minus me-1"></i>{% endif %}
                        ${{ "%.2f"|format(diferencia|abs) }}
                        ({{ 'Sobrante' if diferencia > 0 else ('Faltante' if diferencia < 0 else 'Perfecto') }})
                    </td>
                    <td>{{ cuadre.usuario.nombre_usuario }}</td>
                    <td>${{ "%.2f"|format(cuadre.ventas_total_sistema) }}</td>
                </tr>
                {% else %}
                <tr>
                    <td colspan="7" class="text-center text-muted">No hay cuadres registrados aún.</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endblock %}